clc

kRocks=[1.39190403511773;1.39190403511773;1.39190403511773;1.40382906742292;1.42344064617770;1.44844242277696;1.47760996702233;1.51030553072979;1.54620780857713;1.58516144704435;1.62709329152964;1.67196584783134;1.71975149908501;1.77041831502943;1.82392238731859;1.88020389190118;1.93918476340158;2.00076653405699;2.06483058678019;2.13124903674144;2.19987445297635;2.27054349502082;2.34307898790866;2.41729172177345;2.49298225289683;2.56994274710458;2.64795885752058;2.72681161579626;2.80627931293511;2.88613934603323;2.96617000861700;3.04615220419766;3.12587106500359;3.20511746049934;3.28368938316197;3.36139320194673;3.43804477681590;3.51347043051108;3.58750777631922;3.66000640284082;3.73082841866748;3.79984886139667;3.86695597656249;3.93205137286531;3.99505006057807;4.05588038028925;4.11448382888823;4.17081478442404;4.22484033947294;4.27653998588511;4.32592476782861;4.37297763316430;4.41770914456818;4.46014137233219;4.50030559815807;4.53824145989250;4.57399617521459;4.60762375461317;4.63918420635379;4.66874274122145;4.69636898486676;4.72213620521649;4.74612056151113;4.76840037735004;4.78905541109026;4.80816587737306;4.82580931460566;4.84204109047605;4.85675534768035;4.86869893265894;4.86869893265894;4.86869893265894];
kFluid=[0.0629685388215521;0.0629685388215521;0.0627092641645905;0.0624930167832092;0.0622899165221140;0.0620834245270165;0.0618643658740238;0.0616275292414626;0.0613698283281351;0.0610893203795342;0.0607846914389251;0.0604549933658156;0.0600995149875246;0.0597177234575832;0.0593092413097160;0.0588738407290365;0.0584114466883880;0.0579218229322923;0.0574059323923830;0.0568637851020739;0.0562959588739370;0.0557031971375781;0.0550864078543093;0.0544466598658589;0.0537851771845896;0.0531033314476352;0.0524026326818671;0.0516847185131463;0.0509513419605627;0.0502043579708580;0.0494457088650442;0.0486774088858358;0.0479015280491721;0.0471201755144292;0.0463354826949050;0.0455495863321979;0.0447646117549796;0.0439826565345702;0.0432057747371561;0.0424359619561566;0.0416751412890290;0.0409251504015745;0.0401877298004560;0.0394645124119420;0.0387570145425298;0.0380666282754614;0.0373946153377137;0.0367421024707138;0.0361100776524985;0.0354998267338715;0.0349109437695907;0.0343446674058409;0.0338014300396717;0.0332815285960875;0.0327851300458231;0.0323122770395983;0.0318628944369680;0.0314367965903490;0.0310336952623819;0.0306532080514633;0.0302948671981420;0.0299581286454782;0.0296423812307185;0.0293469559042212;0.0290711349870822;0.0288141623291738;0.0285752616407239;0.0283537179595431;0.0281494235783613;0.0279667307902887;0.0279665955408664;0.0279665155627238];
fluidTemps=[652.496067236777;652.496067236777;647.327321212992;643.027597600296;638.998535475269;634.911314002928;630.585342355222;625.919779065347;620.856656334474;615.361247110294;609.411785606808;602.994216480298;596.099611733555;588.722974367010;580.862738290459;572.520595696346;563.701484855756;554.407560523393;544.663881460835;534.477469613447;523.866087546721;512.850465723278;501.454158272037;489.703350328955;477.626629994253;465.254732372174;452.620261511968;439.757395515363;426.701579831169;413.489213579927;400.157333563729;386.743300391059;373.284490871282;359.818000503833;346.380359504407;333.007265381065;319.733334608512;306.591875463077;293.614683590565;280.831861400162;268.271661924954;255.960357375497;243.922132246213;232.179000520888;220.750746265544;209.654886691448;198.906656632545;188.519013552185;178.502651550395;168.872945437502;159.618669065243;150.754656939508;142.283158794220;134.204488277421;126.517143953600;119.217924973430;112.302053938365;105.763305161868;99.5941368934534;93.7858260876659;88.3286043152335;83.2117934495979;78.4239398399439;73.9529459609596;69.7862002556559;65.9107186517891;62.3134075009180;58.9822730298786;55.9145919297942;53.1745935598790;53.1725662600294;53.1713674472803];
rockTemps=[633.866398813638;633.866398813638;633.866398813638;631.854067731296;628.544642023729;624.325626176699;619.403640569835;613.886304146119;607.827836693355;601.254453889836;594.178500436179;586.606303349015;578.542522817234;569.992546875451;560.963784818680;551.466331690382;541.513360743979;531.121487840442;520.310729580821;509.102666116858;497.522176033540;485.596822672534;473.356503961807;460.833148733325;448.060412799652;435.073367884525;421.908184755170;408.601814080147;395.191669042495;381.715313704005;368.210160886944;354.713183012406;341.260638939425;327.887819402128;314.628813159276;301.516295470868;288.581340020000;275.853254924612;263.359443050075;251.125286452459;239.174054461976;227.526834659406;216.202485804129;205.217611636678;194.586554395220;184.321406837715;174.432041604472;164.926157644957;155.809308336990;147.084954953729;138.751233562502;130.811022117105;123.262538450188;116.102058439937;109.324303526016;102.922585037748;96.8889351957590;91.2142399208830;85.8883729949830;80.9003302598194;76.2383625330411;71.8901059822807;67.8427088498859;64.0829541266160;60.5973826722565;57.3724583348649;54.3950965735456;51.6559542168078;49.1728952613502;47.1573926256957;47.1573926256957;47.1573926256957];
voidFractionRocks=0.4;
d=0.032;
numRows=72;
emissivityRocks =0.83;


    fluidTemps(:) =fluidTemps(:)+273.15;   
    rockTemps(:) =rockTemps(:)+273.15;   
    
    
    beta = 0.9;
    gamma = 0.66666666667;
    voidFractionRocks1 = 0.476;
    voidFractionRocks2 = 0.26; 
    VF1 = 0.476;
    VF2 = 0.26;
    s2t1 = 0.666666666666667;   % 1/.5
    s2t2 = 0.144337567297406;   % 1/4/sqrt(3)
    ct1 = 0.577350269189626;    % cos(asin(sqrt(s2t1)))
    ct2 = 0.925020233671996;    % cos(asin(sqrt(s2t2)))

    % keffinputs = [kRocks, fluidTemps(i), voidFractionRocks, rockAverageDiameter];
    keff(numRows) = 0;
    
    
    i = 20;
    for i=1:1:numRows
        kappa = kRocks(i)/kFluid(i);
    
        hrv = (0.1952/(1+voidFractionRocks/2/(1-voidFractionRocks)*(1-emissivityRocks)/emissivityRocks))*(fluidTemps(i)/100)^3;         
        hrs = 0.1952*(emissivityRocks/(2-emissivityRocks))*(rockTemps(i)/100)^3;
%         hrv = (0.1952/(1+voidFractionRocks/2/(1-voidFractionRocks)*(1-0.85)/0.85))*(fluidTemps(i)/100)^3;         
%         hrs = 0.1952*(0.85/(2-0.85))*(fluidTemps(i)/100)^3;



        phi1(i) = 0.5*(((kappa-1)/kappa)^2*s2t1) / (log(kappa-(kappa-1)*ct1)-(kappa-1)/kappa*(1-ct1))-2/3/kappa;
        phi2(i) = 0.5*(((kappa-1)/kappa)^2*s2t2) / (log(kappa-(kappa-1)*ct2)-(kappa-1)/kappa*(1-ct2))-2/3/kappa;
%         phi1(i) = 0.5*(((kappa-1)/kappa)^2*0.6666667) / (log(kappa-(kappa-1)*0.577350269)-(kappa-1)/kappa*(1-0.577350269))-2/3/kappa;
%         phi2(i) = 0.5*(((kappa-1)/kappa)^2*0.1443376) / (log(kappa-(kappa-1)*0.925020234)-(kappa-1)/kappa*(1-0.925020234))-2/3/kappa;

        phi(i) = phi2(i) + (phi1(i)-phi2(i))*(voidFractionRocks-VF2)/(VF1-VF2);
%         phi(i) = phi2(i) + (phi1(i)-phi2(i))*(voidFractionRocks-0.26)/(0.216);
        
        hrvterm(i) = kFluid(i)*(voidFractionRocks*(1+beta*hrv*d/kFluid(i)));
        hrsterm(i) = kFluid(i)*(beta*(1-voidFractionRocks)/(1/phi(i)+hrs*d/kFluid(i))+gamma/kappa);
        keff(i) = hrvterm(i) + hrsterm(i);
        
        disp('rockTemp(i) fluidTemp(i) kRock(i) kFluid(i) hrvterm(i) hrsterm(i) keff(i)      i')
        disp([rockTemps(i) fluidTemps(i) kRocks(i) kFluid(i) hrvterm(i) hrsterm(i) keff(i) i])
%         keff(i) = kFluid(i)*(voidFractionRocks*(1+beta*hrv*d/kFluid(i))+beta*(1-voidFractionRocks)/(1/phi(i)+hrs*d/kFluid(i))+gamma/kappa);
%         keff(i) = kFluid(i)*(voidFractionRocks*(1+0.9*hrv*d/kFluid(i))+0.9*(1-voidFractionRocks)/(1/(1/phi(i))+hrs*d/kFluid(i))+0.66667*(1/kappa));
    end